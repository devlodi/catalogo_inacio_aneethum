<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catalogo aneehtum inacio</title>
<link rel="stylesheet" href="style.css">
    <!-- PapaParse -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
 
<body>

    
     <div id="header">
        <button class="btn" onclick="toggleCarrinho()">Carrinho<span id="contador">0</span></button>
        <button class="btn" onclick="abrirModalDúvidas()">Dúvidas</button>
        <div id="detalhesCarrinho">
            <!-- Os itens do carrinho e o total serão inseridos aqui pelo JavaScript -->
        </div>
    </div>
    
    <div id="produtos">
    <div class="instrucoes">
        <p>Bem-vindo ao catalogo do Inacio!</p>
    </div>
    <!-- Os produtos serão inseridos aqui pelo JavaScript -->
</div>

<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="fecharModal()">&times;</span>
        <p id="descricaoProduto"></p>
    </div>
</div>

    <div id="popup" class="popup">
    <span class="popup-text" id="popupText"></span>
</div>

    <div id="modalDúvidas" class="modal">
    <div class="modal-content">
        <span class="close" onclick="fecharModalDúvidas()">&times;</span>
        <p>Aqui você pode ver todos os nossos produtos disponíveis. Para adicionar um item ao seu carrinho, basta clicar no botão "Colocar no Carrinho" abaixo do produto desejado. Você pode visualizar os itens no seu carrinho e o total da sua compra clicando no botão "Carrinho" no topo da página. Quando estiver pronto para finalizar a compra, clique em "Mandar Pedido pelo WhatsApp" no carrinho para enviar o seu pedido via WhatsApp.</p>
    </div>
</div>

    <button class="btn" onclick="abrirModalFiltrar()">Filtrar Linhas</button>

<!-- Modal para Filtragem de Linhas -->
<div id="modalFiltrar" class="modal">
    <div class="modal-content">
        <span class="close" onclick="fecharModalFiltrar()">&times;</span>
        <div id="opcoesFiltragem">
            <!-- As opções de filtragem serão inseridas aqui pelo JavaScript -->
        </div>
    </div>
</div>

    
   <script type="text/javascript">

var carrinho;
var total;

carregarCarrinho();  // Mova esta linha para cima, antes das inicializações das variáveis

function carregarCarrinho() {
    var carrinhoSalvo = localStorage.getItem('carrinho');
    if (carrinhoSalvo) {
        carrinho = JSON.parse(carrinhoSalvo);
        total = carrinho.reduce((soma, item) => soma + item.preco, 0);
    } else {
        // Inicializa as variáveis se não houver nada no Local Storage
        carrinho = [];
        total = 0;
    }
    // Chame atualizarCarrinho após carregar o carrinho do Local Storage
    atualizarCarrinho();
}
       

        function toggleCarrinho() {
            var headerDiv = document.getElementById('header');
            if (headerDiv.classList.contains('ativo')) {
                headerDiv.classList.remove('ativo');
            } else {
                headerDiv.classList.add('ativo');
            }
        }

        function parsePreco(preco) {
            return parseFloat(preco.replace(',', '.').replace('R$ ', ''));
        }

function adicionarAoCarrinho(produto, preco) {
    preco = parsePreco(preco);  // Converta a string de preço para um número
    if (isNaN(preco)) {
        console.error('Preço inválido:', preco);
        return;
    }
    carrinho.push({ produto: produto, preco: preco });
    total += preco;  // Adicione o preço ao total
    document.getElementById('contador').innerText = carrinho.length;
    atualizarCarrinho();
    var indexMensagemAleatoria = Math.floor(Math.random() * mensagensCarrinho.length);
    var mensagemAleatoria = mensagensCarrinho[indexMensagemAleatoria];
    mostrarPopup(mensagemAleatoria);
    localStorage.setItem('carrinho', JSON.stringify(carrinho));  // Salve o carrinho no Local Storage
}

function removerDoCarrinho(index) {
    total -= carrinho[index].preco;  // Subtrai o preço do item do total
    carrinho.splice(index, 1);  // Remove o item do carrinho
    atualizarCarrinho();
    localStorage.setItem('carrinho', JSON.stringify(carrinho));  // Salva o carrinho atualizado no Local Storage
}

function zerarCarrinho() {
    carrinho = [];  // Esvazie o array carrinho
    total = 0;  // Zere a variável total
    localStorage.setItem('carrinho', JSON.stringify(carrinho));  // Atualize o carrinho no Local Storage
    atualizarCarrinho();  // Atualize o carrinho na página
}

       

       
var mensagensCarrinho = [];  // Array para armazenar as mensagens do carrinho


        function enviarPedido() {
            var mensagem = encodeURIComponent("Oi Inacio, quero estes produtos:\n\n" +
                carrinho.map(item => `${item.produto} - R$ ${item.preco.toFixed(2)}`).join('\n\n') +
                `\n\nTotal: R$ ${total.toFixed(2)}`);
            window.open(`https://wa.me/5551984424822?text=${mensagem}`);
        }

function abrirModal(descricao) {
    var modal = document.getElementById("myModal");
    var descricaoProduto = document.getElementById("descricaoProduto");
    descricaoProduto.innerText = decodeURIComponent(descricao);
    modal.classList.add('show');
}

function fecharModal() {
    var modal = document.getElementById("myModal");
    modal.classList.remove('show');
}

function abrirModalDúvidas() {
    var modal = document.getElementById("modalDúvidas");
    modal.classList.add('show');
}

function fecharModalDúvidas() {
    var modal = document.getElementById("modalDúvidas");
    modal.classList.remove('show');
}

       

   function atualizarCarrinho() {
    var detalhesCarrinho = document.getElementById('detalhesCarrinho');
    var conteudoCarrinho = '';
    var listaItens = '';
    carrinho.forEach((item, index) => {
        listaItens += `
            <p>
                ${item.produto} - R$ ${item.preco.toFixed(2)}
                <span onclick="removerDoCarrinho(${index})" style="cursor:pointer;">&#128465;</span>
            </p>`;
    });
   listaItens += `<p>Total: R$ ${total.toFixed(2)} <button class="btn-clear" onclick="zerarCarrinho()">Zerar Carrinho</button></p>`;
       
    conteudoCarrinho = `
        <div>
            ${listaItens}
        </div>
        <button class="btn" onclick="enviarPedido()">Mandar Pedido pelo WhatsApp</button><br>
    `;
    detalhesCarrinho.innerHTML = conteudoCarrinho;
    document.getElementById('contador').innerText = carrinho.length;
}







       
var timeoutId;  // Variável para armazenar o ID do temporizador

function mostrarPopup(mensagem) {
    // Cancelar o temporizador anterior, se houver
    if (timeoutId) {
        clearTimeout(timeoutId);
    }

    var popup = document.getElementById('popup');
    var popupText = document.getElementById('popupText');
    popupText.innerText = mensagem;
    popup.classList.add('show');

    // Ocultar o pop-up após 3 segundos
    timeoutId = setTimeout(function() {
        popup.classList.remove('show');
    }, 5000);
}




// ... (o código para carregar os produtos da planilha) ...
Papa.parse('https://docs.google.com/spreadsheets/d/e/2PACX-1vTGy-7_SfKpf4b6HpIL2-f6JNugN8VPQPT_qfQb0gjoTn4qvh3Vyupbr4aVJcdmn1Sma3zlSYJQ0W_z/pub?output=csv', {
    download: true,
    header: true,
    complete: function(results) {
        var data = results.data;
         mensagensCarrinho = data.map(item => item.MSG_CARRINHO).filter(mensagem => mensagem && mensagem.trim());  // Filtrar mensagens vazias                    
        var productsContainer = document.getElementById('produtos');
        for (var i = 0; i < data.length; i++) {
            var descricaoEscapada = encodeURIComponent(data[i].DESCRIÇÃO);
            var productCard = `
    <div class="card">
        <img src="${data[i].IMAGEM}" alt="${data[i].PRODUTOS}">
        <h5 class="card-title">${data[i].PRODUTOS}</h5>
         <button class="btn-info" onclick="abrirModal('${encodeURIComponent(data[i].DESCRIÇÃO)}')">Mais Sobre</button>
        <p class="product-line">Linha: ${data[i].LINHA}</p>
        <p class="card-text">Preço ${data[i].PREÇO}</p>
        <button class="btn" onclick="adicionarAoCarrinho('${data[i].PRODUTOS}', '${data[i].PREÇO}')">Colocar no Carrinho</button>
    </div>`;
            productsContainer.innerHTML += productCard;
        }
    }

});

function obterLinhasUnicas() {
    var elementosLinhas = document.querySelectorAll('.product-line');
    var linhas = [];
    elementosLinhas.forEach(elemento => {
        var linha = elemento.textContent.replace('Linha: ', '');
        if (!linhas.includes(linha) && linha.trim() !== '') {
            linhas.push(linha);
        }
    });
    return linhas;
}

       function atualizarOpcoesFiltragem() {
    var linhas = obterLinhasUnicas();
    var opcoesFiltragemDiv = document.getElementById('opcoesFiltragem');
    opcoesFiltragemDiv.innerHTML = '';
    linhas.forEach(linha => {
        opcoesFiltragemDiv.innerHTML += `
            <div>
                <input type="checkbox" id="${linha}" checked onclick="toggleFiltro('${linha}')">
                <label for="${linha}">${linha}</label>
            </div>`;
    });
}

       // Suponha que esta função seja chamada após os produtos serem renderizados
function produtosCarregados() {
    atualizarOpcoesFiltragem();
}

       function abrirModalFiltrar() {
    var modal = document.getElementById("modalFiltrar");
    modal.classList.add('show');
}

function fecharModalFiltrar() {
    var modal = document.getElementById("modalFiltrar");
    modal.classList.remove('show');
}



       
    </script>

</body>

</html>
